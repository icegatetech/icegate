name: icegate.jobmanager

services:
  jobmanager.minio:
    image: minio/minio:RELEASE.2025-01-20T14-49-07Z # Release older 2024-01-16 doesn't support If-None-Match: *
    container_name: jobmanager.minio
    ports:
      - "9000:9000" # MinIO API
      - "9001:9001" # MinIO Console
    hostname: minio
    environment:
      MINIO_ROOT_USER: minioadmin
      MINIO_ROOT_PASSWORD: minioadmin
    command: server /data --console-address ":9001"
    volumes:
      - ./.tmp/minio_data:/data
  jobmanager.mc-minio:
    image: minio/mc:latest
    container_name: jobmanager.mc.minio
    depends_on:
      - jobmanager.minio
    environment:
      - AWS_ACCESS_KEY_ID=minioadmin
      - AWS_SECRET_ACCESS_KEY=minioadmin
      - AWS_REGION=us-east-1
    entrypoint: >
      /bin/sh -c "
      echo 'Starting mc container...';
      until (/usr/bin/mc alias set minio http://minio:9000 minioadmin minioadmin) do echo '...waiting for minio...' && sleep 1; done;
      echo 'MinIO alias set successfully';
      echo 'Creating buckets...';
      /usr/bin/mc mb --ignore-existing minio/jobs;
      echo 'All buckets created successfully';
      tail -f /dev/null
      "
